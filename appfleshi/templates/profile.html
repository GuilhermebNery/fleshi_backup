{% extends "homepage.html" %}

{%block title%}
    Perfil - {{username}}
{% endblock %}

{% block body %}
    <body>

        {% include "navbar.html" %}

        <h1>Perfil do usu√°rio: {{ user.username }}</h1>


<audio id="audioNotificacao" src="{{ url_for('static', filename='sons/alerta.mp3') }}" preload="auto"></audio>



<button id="btnAtivarSom" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 9999; padding: 10px; background-color: #ff4b4b; color: white; border: none; border-radius: 5px; cursor: pointer;">
    üîá Ativar Sons de Notifica√ß√£o
</button>
        {% if form %}
            <form method="post" enctype="multipart/form-data">
                {{ form.csrf_token }}

                {{ form.photo() }}
                {{ form.submit() }}

            </form>
        {% endif %}
        <div class="container grid">
            {% for photo in user.photos %}
                <div class="div-a" style="display:flex; justify-content: center; ">
                        <a class="shadow-lg " style=" padding: 30px 30px 90px 30px; background: #EFECE2; margin-bottom: 30px; border-radius: 2rem" href="{{ url_for('profile', user_id=photo.user_id) }}">
                            <img class="image-feed" src="{{url_for('static',filename='posts_photos/'~ photo.file_name)}}" alt="Imagem defult">
                        </a>
                </div>

            {% endfor %}
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script type="text/javascript">
    var socket = io();
    var audio = document.getElementById("audioNotificacao");
    var btnAtivar = document.getElementById("btnAtivarSom");

    // Fun√ß√£o que tenta tocar o som
    function tentarTocarSom() {
        // Tenta dar o play
        var promessa = audio.play();

        if (promessa !== undefined) {
            promessa.then(_ => {
                // SUCESSO: O som tocou, podemos esconder o bot√£o se ele estiver vis√≠vel
                console.log("üéµ Som tocou!");
                btnAtivar.style.display = "none";
            }).catch(error => {
                // FALHA: O navegador bloqueou
                console.log("Autoplay bloqueado. Mostrando bot√£o para o usu√°rio.");
                // Mostra o bot√£o para o usu√°rio clicar
                btnAtivar.style.display = "block";
            });
        }
    }

    // Quando o usu√°rio clicar no bot√£o vermelho, desbloqueamos o √°udio
    btnAtivar.addEventListener('click', function() {
        audio.play(); // Toca o som (agora funciona porque foi um clique)
        audio.pause(); // Pausa imediatamente
        audio.currentTime = 0; // Rebobina
        btnAtivar.style.display = "none"; // Esconde o bot√£o
        alert("Sons ativados com sucesso!");
    });

    socket.on('connect', function() {
        console.log("‚úÖ Conectado!");
    });

    socket.on('novo_post', function(data) {
        console.log("üì© Notifica√ß√£o:", data.mensagem);
        // Tenta tocar o som quando chega a mensagem
        tentarTocarSom();
    });
</script>


    </body>

{% endblock %}
